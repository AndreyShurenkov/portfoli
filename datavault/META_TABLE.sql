DECLARE
 TYPE list_str IS TABLE OF varchar2(100);
 vlistDel list_str := list_str('DROP TABLE DV_META_TAB_SET_BASE',
 							   'DROP TABLE DV_META_TAB_SET_USER',
 							   'DROP TABLE DV_META_SRC_BASE',
 							   'DROP TABLE DV_META_SRC_ETL',
 							   'DROP TABLE DV_META_SRC_TABLE');
BEGIN 
FOR i IN  vlistDel.FIRST .. vlistDel.last
 LOOP
  BEGIN
	EXECUTE IMMEDIATE vlistDel(i);
  EXCEPTION 
  WHEN OTHERS THEN NULL;
  END;
 END LOOP;
END;

-- Таблица с базовыми настройками объектов DV
DROP TABLE DV_META_TAB_SET_BASE;
CREATE TABLE DV_META_TAB_SET_BASE(ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
								  TABLE_TYPE_ID NUMBER,
								  TABLE_TYPE VARCHAR2(10),
								  COLUMN_NAME VARCHAR2(100),
								  DATA_TYPE VARCHAR2(20),
								  DATA_LENGHT NUMBER,
								  DEFAULT_VAL VARCHAR2(100),
								  COLUMN_ID NUMBER,
								  ADD_SQL VARCHAR2(4000));

-- Таблица с пользовательскими настройками объектов DV
CREATE TABLE DV_META_TAB_SET_USER(ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
								  DV_META_TAB_SET_BASE_ID NUMBER,
								  TABLE_NAME VARCHAR2(100),
								  COLUMN_NAME VARCHAR2(100),
								  DATA_TYPE VARCHAR2(20),
								  DATA_LENGHT NUMBER,
								  DEFAULT_VAL VARCHAR2(100),
								  COLUMN_ID NUMBER,
								  PK_KEY NUMBER,
								  BUS_KEY NUMBER,
								  INDX VARCHAR2(100),
								  ADD_SQL VARCHAR2(4000),
								  PARENT_TABLE VARCHAR2(10));
-- Таблица с базовым запросом
CREATE TABLE DV_META_SRC_BASE(ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
							  TABLE_NAME VARCHAR2(100),
							  SRC CLOB,
							  CREATE_DATE TIMESTAMP DEFAULT SYSDATE,
							  DELETE_DATE TIMESTAMP,
							  RECORD_SOURCE VARCHAR2(10));

-- Таблица ETL полученным на основе базового запроса							  
CREATE TABLE DV_META_SRC_ETL (ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
							  TABLE_NAME VARCHAR2(100),
							  SRC CLOB,
							  SRC_BASE_ID NUMBER,
							  ORDER_ID NUMBER,
							  CREATE_DATE DATE DEFAULT SYSDATE,
							  DELETE_DATE DATE,
							  START_DATE TIMESTAMP,
							  FINISH_DATE TIMESTAMP,
							  STATUS CHAR(1),
							  MESSAGE VARCHAR2(4000),
							  ACTIVE_FLG NUMBER);

-- Таблица с DDL скриптами объектов DV
CREATE TABLE DV_META_SRC_TABLE (ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
								TABLE_NAME VARCHAR2(100),
								SRC CLOB,
								RUNNING_DATE TIMESTAMP,
								STATUS char(1),
								MESSAGE VARCHAR2(4000),
								ACTIVE_FLG NUMBER);

--- Заполняем таблицу с базвовыми настройками
BEGIN
	INSERT INTO DV_META_TAB_SET_BASE (TABLE_TYPE, COLUMN_NAME, DATA_TYPE, DATA_LENGHT, DEFAULT_VAL, COLUMN_ID, ADD_SQL) VALUES('hub', 'load_date', 'date', NULL, 'sysdate', 2, NULL);
	INSERT INTO DV_META_TAB_SET_BASE (TABLE_TYPE, COLUMN_NAME, DATA_TYPE, DATA_LENGHT, DEFAULT_VAL, COLUMN_ID, ADD_SQL) VALUES('hub', 'record_source', 'number', NULL, NULL, 3, NULL);
	INSERT INTO DV_META_TAB_SET_BASE (TABLE_TYPE, COLUMN_NAME, DATA_TYPE, DATA_LENGHT, DEFAULT_VAL, COLUMN_ID, ADD_SQL) VALUES('hub', 'dummy', 'raw', NULL, 'standard_hash(val,''SHA256'')', 1, NULL);
	INSERT INTO DV_META_TAB_SET_BASE (TABLE_TYPE, COLUMN_NAME, DATA_TYPE, DATA_LENGHT, DEFAULT_VAL, COLUMN_ID, ADD_SQL) VALUES('sat', 'load_date', 'date', NULL, 'sysdate', 2, NULL);
	INSERT INTO DV_META_TAB_SET_BASE (TABLE_TYPE, COLUMN_NAME, DATA_TYPE, DATA_LENGHT, DEFAULT_VAL, COLUMN_ID, ADD_SQL) VALUES('sat', 'load_end_date', 'date', NULL, NULL, 3, NULL);
	INSERT INTO DV_META_TAB_SET_BASE (TABLE_TYPE, COLUMN_NAME, DATA_TYPE, DATA_LENGHT, DEFAULT_VAL, COLUMN_ID, ADD_SQL) VALUES('sat', 'dummy', 'raw', NULL, 'standard_hash(val,''SHA256'')', 1, NULL);
	INSERT INTO DV_META_TAB_SET_BASE (TABLE_TYPE, COLUMN_NAME, DATA_TYPE, DATA_LENGHT, DEFAULT_VAL, COLUMN_ID, ADD_SQL) VALUES('sat', 'has_diff', 'raw', NULL, 'standard_hash(val,''SHA256'')', 4, NULL);
END;